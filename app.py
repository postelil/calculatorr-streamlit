import streamlit as st
import os

# --- 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –°—Ç—Ä–∞–Ω–∏—Ü—ã ---
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –º–∞–∫–µ—Ç
st.set_page_config(
    page_title="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å –ò—Å—Ç–æ—Ä–∏–µ–π",
    layout="centered"
)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("üöÄ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å –ò—Å—Ç–æ—Ä–∏–µ–π")
st.write("–í–≤–µ–¥–∏—Ç–µ –¥–≤–∞ —á–∏—Å–ª–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é.")

# --- 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ò—Å—Ç–æ—Ä–∏–∏ ---
# –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Å—Å–∏–∏, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
if 'history' not in st.session_state:
    st.session_state['history'] = []

# --- 3. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ß–∞—Å—Ç—å) ---

# –°–æ–∑–¥–∞–µ–º 5 –∫–æ–ª–æ–Ω–æ–∫: 3 –¥–ª—è –≤–≤–æ–¥–∞ –∏ 2 –¥–ª—è –æ—Ç—Å—Ç—É–ø–æ–≤/–∫–∞—Ä—Ç–∏–Ω–∫–∏
col_left_spacer, col_input, col_right_image = st.columns([1, 2, 2])

# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–≤–æ–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ (col_input)
with col_input:
    # 3 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –≤–≤–æ–¥–∞ —á–∏—Å–µ–ª –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
    c1, c2, c3 = st.columns([1, 1, 1])

    with c1:
        number1 = st.number_input("–ü–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ:", value=0.0, key="num1")
    with c2:
        operation = st.selectbox("–û–ø–µ—Ä–∞—Ü–∏—è:", ("+", "-", "*", "/"), key="op")
    with c3:
        number2 = st.number_input("–í—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ:", value=0.0, key="num2")

    result = None
    symbol = operation

    # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
    if st.button("–í—ã—á–∏—Å–ª–∏—Ç—å", use_container_width=True):
        try:
            if symbol == "+":
                result = number1 + number2
            elif symbol == "-":
                result = number1 - number2
            elif symbol == "*":
                result = number1 * number2
            elif symbol == "/":
                if number2 != 0:
                    result = number1 / number2
                else:
                    st.error("‚ùå –û—à–∏–±–∫–∞: –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å!")
                    result = None  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ–±—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é

            if result is not None:
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏ (–æ–∫—Ä—É–≥–ª—è–µ–º –¥–æ 3 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)
                # –ï—Å–ª–∏ —á–∏—Å–ª–æ —Ü–µ–ª–æ–µ, –≤—ã–≤–æ–¥–∏–º –∫–∞–∫ —Ü–µ–ª–æ–µ
                if result == int(result):
                    result_str = str(int(result))
                else:
                    result_str = f"{result:.3f}"

                # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏
                entry = f"**{number1} {symbol} {number2}** = **{result_str}**"

                # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
                st.session_state['history'].insert(0, entry)

                # –û–±—Ä–µ–∑–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é, —á—Ç–æ–±—ã –±—ã–ª–æ –Ω–µ –±–æ–ª–µ–µ 10 –∑–∞–ø–∏—Å–µ–π (–í–ê–®–ï –ü–û–ñ–ï–õ–ê–ù–ò–ï)
                st.session_state['history'] = st.session_state['history'][:10]

                st.success(f"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: **{result_str}**")

        except Exception as e:
            st.error(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {e}")

# --- 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ö–∞—Ä—Ç–∏–Ω–∫–∏ (–ü—Ä–∞–≤–∞—è –ß–∞—Å—Ç—å) ---
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏
IMAGE_FILENAME = "calc_buddy.png"  # –ò–º—è —Ñ–∞–π–ª–∞, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ
if os.path.exists(IMAGE_FILENAME):
    with col_right_image:
        st.image(IMAGE_FILENAME, caption="–í–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö", use_column_width=True)
else:
    with col_right_image:
        st.info(f"–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª **{IMAGE_FILENAME}** –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å–ø—Ä–∞–≤–∞.")

# --- 5. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ò—Å—Ç–æ—Ä–∏–∏ (–õ–µ–≤–∞—è –ë–æ–∫–æ–≤–∞—è –ü–∞–Ω–µ–ª—å) ---
st.sidebar.markdown("---")
st.sidebar.header("üìú –ò—Å—Ç–æ—Ä–∏—è –†–µ—à–µ–Ω–∏–π")

# –í –≤–∞—à–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –±—ã–ª–∞ –≥–∏—Ñ–∫–∞, —è –æ—Å—Ç–∞–≤–∏–ª –µ–µ –ø—Ä–æ–≤–µ—Ä–∫—É
GIF_FILENAME = "rotating_gear.gif"
if os.path.exists(GIF_FILENAME):
    st.sidebar.image(GIF_FILENAME, caption="–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å", use_column_width=True)
else:
    st.sidebar.caption(f"–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª **{GIF_FILENAME}** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–∏—Ñ–∫–∏.")
st.sidebar.markdown("---")

if st.session_state['history']:
    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
    for i, entry in enumerate(st.session_state['history']):
        st.sidebar.markdown(f"**{i + 1}.** {entry}")
else:
    st.sidebar.info("–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ!")